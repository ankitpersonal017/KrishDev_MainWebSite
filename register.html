<!DOCTYPE html>
<html lang="en">

<head>

    <!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="Website Design Templates">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="KrishDev Herbal, Member SignUp, Register">
    <meta name="description" content="Register as a member of KrishDev Herbal to access member benefits.">

    <!-- title  -->
    <title>KrishDev Herbal - Member SignUp</title>

    <!-- favicon -->
    <link rel="shortcut icon" href="src/img/logos/favicon.png">
    <link rel="stylesheet" href="src/css/plugins.css" />
    <link rel="stylesheet" href="src/css/search.css" />
    <link rel="stylesheet" href="src/css/base.css" />

    <!-- theme core css -->
    <link href="src/css/styles.css" rel="stylesheet" id="colors">

    <style>
        .error-text {
            color: #d9534f;
            font-size: 13px;
            margin-top: 5px;
            display: block;
        }

        .error-border {
            border-color: #d9534f !important;
            box-shadow: none !important;
        }
    </style>
</head>

<body>

    <!-- PAGE LOADING
    ================================================== -->
    <div id="preloader">
        <div class="row loader">
            <div class="loader-icon"></div>
        </div>
    </div>

    <!-- MAIN WRAPPER
    ================================================== -->

    <div class="main-wrapper">

        <header class="header-style1 menu_area-light">

            <div class="navbar-default border-bottom border-color-light-white">

                <!-- start top search -->
                <div class="top-search bg-primary">
                    <div class="container">
                        <form class="search-form" action="/" method="GET" accept-charset="utf-8">
                            <div class="input-group">
                                <span class="input-group-addon cursor-pointer">
                                    <button class="search-form_submit fas fa-search text-white" type="submit"></button>
                                </span>
                                <input type="text" class="search-form_input form-control" name="s" autocomplete="off"
                                    placeholder="Type & hit enter...">
                                <span class="input-group-addon close-search mt-1"><i class="fas fa-times"></i></span>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- end top search -->
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-12 col-lg-12">
                            <div class="menu_area alt-font">
                                <nav class="navbar navbar-expand-lg navbar-light p-0">

                                    <div class="navbar-header navbar-header-custom">
                                        <a href="/" class="navbar-brand"><img id="logo"
                                                src="src/img/logos/logo-inner.png" alt="logo"></a>
                                    </div>

                                    <div class="navbar-toggler"></div>

                                    <!-- menu area -->
                                    <ul class="navbar-nav ml-auto" id="nav" style="display: none;">
                                        <li>
                                            <a class="text-capitalize" href="index.html">Home</a>
                                        </li>
                                        <li>
                                            <a class="text-capitalize" href="about.html">About Us</a>
                                        </li>
                                        <li>
                                            <a class="text-capitalize" href="opportunity.html">Opportunity</a>
                                        </li>
                                        <li>
                                            <a class="text-capitalize" href="legals.html">Legals</a>
                                        </li>
                                        <li><a class="text-capitalize" href="#!">Login</a>
                                            <ul>
                                                <li><a class="text-capitalize" href="shoppy_login.html">Shoppy</a></li>
                                                <li><a class="text-capitalize" href="members_login.html">Members</a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a class="text-capitalize" href="register.html">Member SignUp</a>
                                        </li>
                                        <li>
                                            <a class="text-capitalize" href="contact.html">Contact</a>
                                        </li>
                                        <li>
                                            <a class="text-capitalize" href="inquiry.html">Inquiry</a>
                                        </li>
                                    </ul>
                                    <!-- end menu area -->


                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </header>

        <!-- PAGE TITLE
        ================================================== -->
        <section class="page-title-section top-position bg-img cover-background" data-overlay-dark="5"
            data-background="src/img/bg-page-title.jpg">
            <div class="container">

                <div class="row">
                    <div class="col-md-12">
                        <h1>Member SignUp</h1>
                    </div>
                    <div class="col-md-12">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li class="text-light">></li>
                            <li><a href="#!">Member SignUp</a></li>
                        </ul>
                    </div>
                </div>

            </div>
        </section>

        <!-- REGISTER FORM
        ================================================== -->
        <section class="bg-light p-0" id="registerSection">
            <div class="container d-flex flex-column">
                <div class="row align-items-center justify-content-center min-vh-100">
                    <div class="col-12 col-sm-12 col-md-12 col-lg-10">
                        <div class="card p-2-0 p-sm-2-5 my-2-0">
                            <div class="mb-4 text-center">
                                <h2 class="font-weight-normal mb-0">Welcome to <span
                                        class="text-primary text-nowrap font-weight-bold">KrishDev
                                        Herbal</span></h2>
                                <p class="mb-0">Register to your account.</p>
                            </div>
                            <form id="registerForm" novalidate>

                                <div class="row">
                                    <!-- Input -->
                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Sponser ID. Number</label>
                                            <input type="text" id="sponserId" class="form-control required"
                                                name="sponserId" placeholder="Sponser ID">
                                        </div>
                                    </div>
                                    <!-- End Input -->
                                    <!-- Input -->
                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Sponser name</label>
                                            <input type="text" id="sponserName" class="form-control" disabled
                                                name="sponserName" placeholder="Sponser name">
                                        </div>
                                    </div>
                                    <!-- End Input -->



                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Position</label>
                                            <select class="form-control required" name="position" id="position">
                                                <option value="" disabled selected>Select position</option>
                                                <option value="LEFT">Left</option>
                                                <option value="RIGHT">Right</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Full Name</label>
                                            <input type="text" id="fullName" class="form-control required"
                                                name="fullName" placeholder="Full name">
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Mobile Number</label>
                                            <input type="text" id="mobileNo" maxlength="10"
                                                class="form-control required" name="mobileNo"
                                                placeholder="Mobile number">
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Date of Birth</label>
                                            <input type="date" id="dateOfBirth" name="dateOfBirth"
                                                class="form-control required">
                                        </div>
                                    </div>



                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Aadhar Card No</label>
                                            <input type="text" id="aadharCard" maxlength="12"
                                                class="form-control required" name="aadharCard"
                                                placeholder="Aadhar Card No">
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Pan Card No</label>
                                            <input type="text" id="panCardNo" maxlength="10" class="form-control"
                                                name="panCardNo" placeholder="Pan Card No">
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Address</label>
                                            <textarea type="text" id="fullAddress" class="form-control required"
                                                rows="3" name="fullAddress" placeholder="Full Address"></textarea>
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>Pincode</label>
                                            <input type="text" id="pinCode" class="form-control required" name="pinCode"
                                                placeholder="Pincode">
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>City</label>
                                            <input type="text" id="city" class="form-control required" name="city"
                                                placeholder="City">
                                        </div>
                                    </div>

                                    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label>State</label>
                                            <select class="form-control required" name="state" id="state">
                                                <option value="">Select State</option>
                                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Andaman & Nicobar">Andaman & Nicobar</option>
                                                <option value="Chandigarh">Chandigarh</option>
                                                <option value="Dadra & Nagar Haveli">Dadra & Nagar Haveli</option>
                                                <option value="Daman & Diu">Daman & Diu</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Jammu & Kashmir">Jammu & Kashmir</option>
                                                <option value="Ladakh">Ladakh</option>
                                                <option value="Lakshadweep">Lakshadweep</option>
                                                <option value="Puducherry">Puducherry</option>
                                            </select>
                                        </div>
                                    </div>



                                    <div class="col-12 col-sm-12 col-md-6">
                                        <div class="form-group">
                                            <label>Password</label>
                                            <input type="password" id="password" class="form-control required"
                                                name="password" placeholder="Password">
                                        </div>
                                    </div>

                                    <!-- Input -->
                                    <div class="col-12 col-sm-12 col-md-6">
                                        <div class="form-group">
                                            <label>Confirm Password</label>
                                            <input type="password" id="confirm_password" class="form-control required"
                                                name="confirm_password" placeholder="Your confirm password">
                                        </div>
                                    </div>
                                    <!-- End Input -->
                                </div>

                                <div class="row mt-2">
                                    <div class="col-12">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input required"
                                                id="terms-condition" name="terms">
                                            <label class="custom-control-label" for="terms-condition">I agree to the <a
                                                    href="#!">Terms &amp; Conditions</a></label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 center">
                                        <button type="submit" class="butn medium btn-block mt-4 mb-0">Register</button>
                                    </div>
                                </div>

                                <div class="text-center text-small mt-4">
                                    <span>Already have an account? <a href="members_login.html"
                                            class="text-green">Login</a></span>
                                </div>
                            </form>
                        </div>
                        <!-- End Form -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Welcome letter with Print & PDF option -->
        <section id="welcomeSection" class="bg-light p-0" style="display:none;">
            <div class="container py-5">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-10">
                        <div class="card p-4"
                            style="background: linear-gradient(180deg,#ffffff 0%, #f7fbff 100%); border: 1px solid #e6eef7;">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h3 class="mb-0" style="color:#0b556b; font-weight:700;">Congratulations! üéâ</h3>
                                <div>
                                    <button type="button" class="butn medium" onclick="downloadWelcomePDF()"
                                        style="background:#f0a500; color:#082032; border:none;">Download PDF</button>
                                </div>
                            </div>

                            <div id="welcomeLetter" class="welcome-letter"
                                style="padding:20px; background:transparent;">
                                <div style="border-left:6px solid #0b556b; padding-left:16px; margin-bottom:18px;">
                                    <h2 style="margin:0; color:#0b556b; font-size:22px;">Your Registration Has Been
                                        Completed Successfully</h2>
                                </div>

                                <p style="color:#333; font-size:15px; line-height:1.6; margin-bottom:18px;">Welcome to
                                    <strong style="color:#0b556b;">KDH (Krish Dev Herbal Pvt Ltd)</strong>.
                                    We wish you great success and are confident that you will have a rewarding journey
                                    with our organization.
                                </p>

                                <h4 class="text-center" style="color:#0b556b; margin:10px;">Registration Details:</h4>

                                <table
                                    style="max-width: 100%;border-collapse:collapse;font-size:15px;color:#222;margin: auto;">
                                    <tr>
                                        <td style="padding:6px 8px; width:35%; color:#555;">Member ID:</td>
                                        <td style="padding:6px 8px; font-weight:700;"><span id="wl_memberId">-</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding:6px 8px; color:#555;">Name:</td>
                                        <td style="padding:6px 8px; font-weight:700;"><span id="wl_name">-</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:6px 8px; color:#555;">Joining Date:</td>
                                        <td style="padding:6px 8px; font-weight:700;"><span id="wl_joiningDate">-</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding:6px 8px; color:#555;">Mobile Number:</td>
                                        <td style="padding:6px 8px; font-weight:700;"><span id="wl_mobile">-</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:6px 8px; color:#555;">Sponsor ID:</td>
                                        <td style="padding:6px 8px; font-weight:700;"><span id="wl_sponsorId">-</span>
                                        </td>
                                    </tr>
                                </table>

                                <p style="margin-top:18px; color:#333; font-size:15px;">Please keep your login
                                    credentials safe for future use.</p>

                                <div style="margin-top:28px; color:#333; font-size:15px;">
                                    <p style="margin:0">Warm Regards,</p>
                                    <p style="margin:0; font-weight:700; color:#0b556b;">Krish Dev Herbal</p>
                                    <p style="margin-top:6px; color:#0b556b; font-weight:600;"><a
                                            href="https://krishdevherbal.in/" target="_blank">üåê
                                            https://krishdevherbal.in/</a> </p>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-3">Tip: Use the <strong>Download PDF</strong> button to
                                save a copy</small>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                /* Letter styling */
                .welcome-letter h2,
                .welcome-letter h4 {
                    font-family: 'Helvetica Neue', Arial, sans-serif;
                }

                .welcome-letter table td:first-child {
                    color: #6b7280;
                }

                /* Print rules: show only the welcome letter */
                @media print {
                    body * {
                        visibility: hidden !important;
                    }

                    #welcomeLetter,
                    #welcomeLetter * {
                        visibility: visible !important;
                    }

                    #welcomeLetter {
                        position: absolute;
                        left: 0;
                        top: 0;
                        width: 100%;
                    }

                    a[href]:after {
                        content: "";
                    }

                    @page {
                        size: A4;
                        margin: 20mm;
                    }
                }
            </style>

            <!-- html2pdf for PDF generation -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
            <script>
                function printWelcome() {
                    window.print();
                }

                function downloadWelcomePDF() {
                    const element = document.getElementById('welcomeLetter');
                    const opt = {
                        margin: 10,
                        filename: 'MBSSS_Welcome_Letter.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2, useCORS: true },
                        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                    };
                    // trigger download
                    html2pdf().set(opt).from(element).save();
                }
            </script>
        </section>

        <footer id="footerContent"></footer>
    </div>
    <a href="#!" class="scroll-to-top"><i class="fa fa-angle-up" aria-hidden="true"></i></a>
    <script src="src/js/core.min.js"></script>
    <script src="src/js/search.js"></script>
    <script src="src/js/main.js"></script>
    <script src="src/js/plugins.js"></script>
    <script src="src/js/scripts.js"></script>
    <!-- all js include end -->

    <script>
        (function () {
            const backendBaseUrl = 'https://krishdevherbal.scorpnidhi.com/api/';

            // safe wrapper: prefer global xhrFetch if available, otherwise fall back to window.fetch
            function safeXhrFetch(url, options) {
                if (typeof window.xhrFetch === 'function') return window.xhrFetch(url, options);
                // fallback to fetch with a compatible response shape
                options = options || {};
                const fetchOpts = { method: options.method || 'GET', headers: options.headers || {} };
                if (options.body) fetchOpts.body = options.body;
                return fetch(url, fetchOpts).then(function (res) {
                    return {
                        ok: res.ok,
                        status: res.status,
                        statusText: res.statusText,
                        text: function () { return res.text(); },
                        json: function () { return res.json(); }
                    };
                });
            }
            const form = document.getElementById('registerForm');
            const requiredFields = Array.from(form.querySelectorAll('.required'));

            function showError(el, msg) {
                el.classList.add('error-border');
                const container = el.closest('.form-group') || el.parentElement;
                let err = container.querySelector('.error-text');
                if (!err) { err = document.createElement('span'); err.className = 'error-text'; container.appendChild(err); }
                err.textContent = msg;
            }

            function formatDateString(iso) {
                if (!iso) return '';
                const d = new Date(iso);
                if (isNaN(d)) return iso;
                const day = d.getDate();
                const year = d.getFullYear();
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                return day + ' ' + monthNames[d.getMonth()] + ' ' + year;
            }

            function populateWelcome(data) {
                if (!data) return;
                const member = data.savedMember || {};
                const pair = data.savedMemberPairObj || {};

                document.getElementById('wl_memberId').innerText = member.memberId || '-';
                document.getElementById('wl_name').innerText = member.fullName || '-';
                document.getElementById('wl_joiningDate').innerText = formatDateString(member.createdOn || member.modifiedOn) || '-';
                document.getElementById('wl_mobile').innerText = member.mobileNo || '-';
                document.getElementById('wl_sponsorId').innerText = pair.sponserId || pair.sponsorId || '-';

                // show the section and scroll to it
                const welcomeSection = document.getElementById('welcomeSection');
                if (welcomeSection) { welcomeSection.style.display = 'block'; welcomeSection.scrollIntoView({ behavior: 'smooth' }); }

                // hide the registration form card to avoid confusion
                try { const formCard = document.getElementById('registerSection'); if (formCard) formCard.style.display = 'none'; } catch (e) { }
            }

            function clearError(el) {
                el.classList.remove('error-border');
                const container = el.closest('.form-group') || el.parentElement;
                const err = container.querySelector('.error-text'); if (err) err.remove();
            }

            function validateField(el) {
                const val = (el.value || '').toString().trim();
                if (el.type === 'checkbox') {
                    if (!el.checked) { showError(el, 'This field is required'); return false; }
                    clearError(el); return true;
                }
                if (el.tagName === 'SELECT') {
                    if (!val) { showError(el, 'Please select an option'); return false; }
                    clearError(el); return true;
                }
                if (!val) { showError(el, 'This field is required'); return false; }

                // regex validations
                const mobileRe = /^[6-9]\d{9}$/;
                const aadharRe = /^\d{12}$/;
                const pincodeRe = /^\d{6}$/;
                const panRe = /^[A-Z]{5}\d{4}[A-Z]$/i;
                console.log('Validating field:', el.id, val);
                if (el.id === 'mobileNo') {
                    if (!mobileRe.test(val)) { showError(el, 'Mobile no should be valid 10 digits'); return false; }
                }
                if (el.id === 'aadharCard') {
                    if (!aadharRe.test(val)) { showError(el, 'Aadhar number must be 12 digits'); return false; }
                }
                if (el.id === 'pinCode') {
                    if (!pincodeRe.test(val)) { showError(el, 'Pincode must be 6 digits'); return false; }
                }
                if (el.id === 'panCardNo') {
                    if (!panRe.test(val)) { showError(el, 'PAN should match format (e.g. ABCDE1234F)'); return false; }
                }

                if (el.id === 'confirm_password') {
                    const pwd = document.getElementById('password').value || '';
                    if (val !== pwd) { showError(el, 'Passwords do not match'); return false; }
                }

                clearError(el); return true;
            }

            requiredFields.forEach(el => {
                el.addEventListener('blur', () => validateField(el));
                el.addEventListener('input', () => { if (el.classList.contains('error-border')) validateField(el); });
            });

            // restrict allowed input characters for specific fields
            const numericOnlyIds = ['sponserId', 'mobileNo', 'aadharCard', 'pinCode'];
            numericOnlyIds.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                el.addEventListener('input', () => {
                    const clean = el.value.replace(/\D/g, '');
                    if (el.value !== clean) el.value = clean;
                    if (el.classList.contains('error-border')) validateField(el);
                });
            });

            const panEl = document.getElementById('panCardNo');
            if (panEl) {
                panEl.addEventListener('blur', () => {
                    const clean = panEl.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                    if (panEl.value !== clean) panEl.value = clean;
                    if (panEl.value) {
                        validateField(panEl);
                    } else {
                        clearError(panEl);
                    }
                });
            }

            // pincode lookup on blur when 6 digits entered
            const pincodeEl = document.getElementById('pinCode');
            if (pincodeEl) {
                pincodeEl.addEventListener('blur', function () {
                    const pin = (this.value || '').toString().trim();
                    if (pin.length === 6) {
                        lookupPincode(pin);
                    }
                });
            }

            function lookupPincode(pin) {

                fetch(`https://api.postalpincode.in/pincode/${pin}`)
                    .then(function (response) { return response.ok ? response.json() : Promise.reject(response); })
                    .then(function (data) {
                        data = data && data[0];
                        if (!data || data.Status !== 'Success' || !data.PostOffice || !data.PostOffice.length) {
                            return;
                        }
                        const postOffice = data.PostOffice[0];
                        if (postOffice.District) {
                            document.getElementById('city').value = postOffice.District;
                            clearError(document.getElementById('city'));
                        }
                        if (postOffice.State) {
                            document.getElementById('state').value = postOffice.State;
                            clearError(document.getElementById('state'));
                        }
                    })
                    .catch(function () {
                        // ignore errors
                    });
            }

            // pincode lookup on blur when 6 digits entered
            const sponserId = document.getElementById('sponserId');
            if (sponserId) {
                sponserId.addEventListener('blur', function () {
                    const sponser = (this.value || '').toString().trim();
                    if (sponser.length === 6) {
                        lookupSponser(sponser);
                    }
                });
            }

            function lookupSponser(sponser) {
                safeXhrFetch(`${backendBaseUrl}memberDetail/basic/${encodeURIComponent(sponser)}`)
                    .then(function (r) { return r.ok ? r.json() : Promise.reject(r); })
                    .then(function (data) {
                        data = data?.data || {};
                        if (!data) return;
                        console.log('Sponser lookup data:', data);
                        if (data.fullName) {
                            document.getElementById('sponserName').value = data.fullName + ' ( ' + data.mobileNo + ' )';
                            clearError(sponserId);
                            return;
                        }
                    })
                    .catch(function () {
                        showError(sponserId, 'Sponser not found');
                        document.getElementById('sponserName').value = '';
                    });
            }

            function clearForm() {
                const els = Array.from(form.querySelectorAll('[name]'));
                els.forEach(el => {
                    if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
                    else if (el.tagName === 'SELECT') el.selectedIndex = 0;
                    else el.value = '';
                    clearError(el);
                });
            }

            form.addEventListener('submit', function (e) {
                e.preventDefault();
                let valid = true;
                requiredFields.forEach(el => { if (!validateField(el)) valid = false; });
                if (!valid) return;

                // collect all named fields (include disabled values too)
                const data = {};
                Array.from(form.querySelectorAll('[name]')).forEach(el => {
                    const name = el.getAttribute('name');
                    if (!name) return;
                    if (el.type === 'checkbox') data[name] = !!el.checked;
                    else data[name] = el.value;
                });

                safeXhrFetch(`${backendBaseUrl}memberDetail/quickJoining`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                })
                    .then(function (res) {
                        if (res.ok) return res.json().catch(function () { return ({}); });
                        return res.json().then(function (body) { return Promise.reject(body); });
                    })
                    .then(function (resp) {
                        clearForm();
                        alert("New Member: " + resp.data.savedMember.memberId + ' (' + resp.data.savedMember.fullName + ') Registration successful, Now you can login to your account.');
                        // populate and show welcome letter
                        try { populateWelcome(resp.data); } catch (e) { console.error(e); }
                    })
                    .catch(function (err) {
                        var msg = (err && err.error.message) ? err.error.message : 'Registration failed';
                        alert(msg);
                    });
            });
        })();
    </script>

</body>

</html>